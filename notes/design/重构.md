# 重构

重构需要开发者洞察出代码存在的坏味道或者设计上的不足，并且能合理、熟练地利用设计思想、原则、模式、编程规范
等理论知识解决这些问题。

大型重构是指对顶层代码设计的重构，包括系统、模块、代码结构、类与类之间的关系等的重构，重构的手端有：
分层、模块化、解耦、抽象可复用组件等等。这类重构影响较大、耗时较长、引入BUG风险也会相对较大。

小型重构是对代码细节的重构，主要是针对类、函数、变量等代码级别的重构。主要利用代码规范等手段来进行。

## 什么时候重构

当项目真正到了“开发效率低，总是出问题，线上BUG频发”的时候，重构已经无法解决问题了。

在平时没有事情的时候，通过看看项目中那些地方的代码写的不够好，可以主动去重构一下。
需要建立持续重构的意识，随着产品的不断迭代，代码质量总会持续下降。

## 如何重构

在做大型重构的时候，需要安排好重构计划，有条不紊地分阶段来执行。保证仓库中的代码是一直处于可运行，逻辑正确的状态后，在进行下一阶段的开发。大规模的重构，一定要有组织、有计划的让有经验、熟悉业务的资深同事来主导。

在重构的时候，单元测试是重构的一个非常重要的过程。有能效的指导如何进行重构，避免重构之后功能缺失或者有隐藏BUG。
并且单元测试是业务的一个非常重要的体现，可以记录在项目的迭代过程中出现的需求更改等。避免了后续的开发中，发现代码和原型不一致的情况时，不知道如何进行下去。单元测试实际上就是用户用例，反映了代码功能和如何使用。

如果出现单元测试很难写的情况，有可能是代码写的不够好。这个时候可以考虑重构自己的代码。

## 如何判断代码耦合度

在阅读源码的时候，把模块与模块之间、类与类之间的依赖关系画出来，根据依赖关系判断代码耦合度。
如果依赖关系复杂、混乱，那么从代码结构上来讲，可读性与可维护性肯定不太好。

## 如何降低代码耦合度

1. *封装与抽象*可以有效地隐藏实现的复杂性，隔离实现的易变性，给依赖的模块提供稳定且易用的抽象接口。
2. *中间层*可以简化模块或者类之间的关系。
